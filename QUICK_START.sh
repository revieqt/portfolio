#!/bin/bash
# Quick Start Guide - Test Your Chat Feature

echo "üöÄ Chat Feature Setup Guide"
echo "============================"
echo ""

# Step 1: Environment Setup
echo "Step 1: Create .env.local"
echo "------------------------"
echo "Create a file named '.env.local' in your project root with:"
echo ""
echo "TELEGRAM_BOT_TOKEN=your_bot_token_here"
echo "TELEGRAM_CHAT_ID=your_chat_id_here"
echo ""
echo "‚ö†Ô∏è  Replace with actual values from:"
echo "  - @BotFather on Telegram for bot token"
echo "  - @userinfobot for your chat ID"
echo ""

# Step 2: Install Dependencies
echo "Step 2: Ensure Dependencies Installed"
echo "------------------------------------"
echo "Run: npm install"
echo ""
echo "Make sure you have:"
echo "  - react: installed"
echo "  - react-icons: installed"
echo "  - typescript: installed"
echo "  - @vercel/node: installed (for serverless functions)"
echo ""

# Step 3: Local Testing
echo "Step 3: Test Locally with Vercel CLI"
echo "-----------------------------------"
echo "1. Install Vercel CLI:"
echo "   npm install -g vercel"
echo ""
echo "2. Run locally:"
echo "   vercel dev"
echo ""
echo "3. Open browser:"
echo "   http://localhost:3000"
echo ""
echo "4. Test the chat:"
echo "   - Click 'Chat with me!' button"
echo "   - Type a message"
echo "   - Click Send or press Enter"
echo "   - Check your Telegram for the message"
echo ""

# Step 4: Telegram Setup
echo "Step 4: Telegram Bot Setup"
echo "------------------------"
echo "1. Open Telegram and search for @BotFather"
echo "2. Send /newbot"
echo "3. Name your bot (e.g., 'Portfolio Bot')"
echo "4. Create username (e.g., 'portfolio_portfolio_bot')"
echo "5. Copy the token ‚Üí Set as TELEGRAM_BOT_TOKEN"
echo ""
echo "6. Search for @userinfobot"
echo "7. Copy your User ID ‚Üí Set as TELEGRAM_CHAT_ID"
echo ""

# Step 5: Test Reply Flow
echo "Step 5: Test Reply Flow"
echo "---------------------"
echo "1. User sends message from chat (test locally or in prod)"
echo ""
echo "2. You receive in Telegram:"
echo "   [session: session_xxx_xxx]"
echo "   User's message here"
echo ""
echo "3. You reply in Telegram with session ID:"
echo "   [session: session_xxx_xxx]"
echo "   Your response here"
echo ""
echo "4. Browser polls every 2 seconds and shows reply"
echo "   Message appears under 'you' sender type"
echo ""

# Step 6: Production Deploy
echo "Step 6: Deploy to Production"
echo "---------------------------"
echo "1. Push changes to GitHub"
echo "2. Vercel auto-deploys (if connected)"
echo "   OR manually run: vercel --prod"
echo ""
echo "3. Set environment variables in Vercel Dashboard:"
echo "   - Go to Settings ‚Üí Environment Variables"
echo "   - Add TELEGRAM_BOT_TOKEN"
echo "   - Add TELEGRAM_CHAT_ID"
echo ""
echo "4. Test in production URL"
echo ""

# Step 7: Features Verification
echo "Step 7: Verify Features"
echo "---------------------"
echo "‚úÖ sessionId generated on first visit (check localStorage)"
echo "‚úÖ Messages saved to localStorage (refresh and see messages)"
echo "‚úÖ Rate limiting active (send 2 messages quickly ‚Üí see alert)"
echo "‚úÖ Message appears immediately after send"
echo "‚úÖ Message format correct in Telegram: [session: xxx]\\nmessage"
echo "‚úÖ Reply appears in browser within 2-4 seconds"
echo "‚úÖ Dark mode works in chat"
echo "‚úÖ Mobile: chat is full screen"
echo "‚úÖ Desktop: chat is 500px sidebar"
echo ""

# File Structure
echo "Step 8: File Structure"
echo "--------------------"
echo "Your chat feature files:"
echo ""
echo "src/components/"
echo "  ‚îî‚îÄ Chat.tsx (updated with localStorage & API)"
echo ""
echo "src/"
echo "  ‚îî‚îÄ App.tsx (updated to use new Chat component)"
echo ""
echo "api/"
echo "  ‚îú‚îÄ send-message.ts (sends to Telegram)"
echo "  ‚îú‚îÄ get-replies.ts (polls for replies)"
echo "  ‚îî‚îÄ get-replies-redis.ts (production upgrade - optional)"
echo ""
echo "Documentation:"
echo "  ‚îú‚îÄ TELEGRAM_SETUP.md (detailed setup guide)"
echo "  ‚îú‚îÄ CHAT_FEATURE_SUMMARY.md (complete reference)"
echo "  ‚îú‚îÄ TELEGRAM_REPLY_FORMAT.md (reply format guide)"
echo "  ‚îî‚îÄ QUICK_START.sh (this file)"
echo ""

# Troubleshooting
echo "Step 9: If Something's Wrong"
echo "----------------------------"
echo ""
echo "Messages not sending?"
echo "  ‚ñ° Check .env.local has correct TELEGRAM_BOT_TOKEN"
echo "  ‚ñ° Check .env.local has correct TELEGRAM_CHAT_ID"
echo "  ‚ñ° Check bot exists in Telegram (@BotFather)"
echo "  ‚ñ° Check network tab in DevTools for API errors"
echo ""
echo "Replies not appearing?"
echo "  ‚ñ° Verify reply includes [session: xxx] format"
echo "  ‚ñ° Check browser console for fetch errors"
echo "  ‚ñ° Ensure polling is running (check Network tab)"
echo ""
echo "localStorage not working?"
echo "  ‚ñ° Check DevTools ‚Üí Application ‚Üí Storage ‚Üí localStorage"
echo "  ‚ñ° Look for 'chat_messages' and 'chat_sessionId'"
echo "  ‚ñ° If missing, clear site data and refresh"
echo ""

# Success Message
echo ""
echo "=========================================="
echo "‚ú® Setup Complete! üéâ"
echo "=========================================="
echo ""
echo "Next: Set up environment variables and run 'vercel dev'"
echo "Questions? See TELEGRAM_SETUP.md for detailed instructions"
echo ""
